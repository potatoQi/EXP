# å®éªŒç®¡ç†æ¡†æ¶

ä¸€ä¸ªç”¨äºç®¡ç†ç§‘ç ”å®éªŒçš„Pythonæ¡†æ¶ï¼Œæä¾›æ™ºèƒ½è¿è¡ŒIDåˆ†é…å’Œæ•°æ®åº“é£æ ¼çš„CSVæŒ‡æ ‡è®°å½•ç³»ç»Ÿã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ”¢ **æ™ºèƒ½è¿è¡ŒID**: è‡ªåŠ¨åˆ†é… `run_0001`, `run_0002`... æ ¼å¼ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†
- ğŸ“Š **CSVæŒ‡æ ‡è®°å½•**: æ•°æ®åº“é£æ ¼çš„ `upd_row()` + `save_row()` æ“ä½œ
- ğŸ”„ **åŠ¨æ€å­—æ®µæ·»åŠ **: è¿è¡Œæ—¶è‡ªç”±æ·»åŠ æ–°æŒ‡æ ‡å­—æ®µï¼ŒCSVè‡ªåŠ¨æ‰©å±•
- ğŸ“ˆ **pandasé›†æˆ**: ä¸€é”®è½¬æ¢ä¸ºDataFrameè¿›è¡Œæ•°æ®åˆ†æ
- ğŸš€ **å…¨è‡ªåŠ¨é…ç½®**: GPUåˆ†é…ã€ç›®å½•åˆ›å»ºã€æ—¥å¿—åˆå§‹åŒ–
- ğŸ“ **æ™ºèƒ½ç»„ç»‡**: è‡ªåŠ¨åˆ›å»ºç»“æ„åŒ–çš„å®éªŒç›®å½•
- ğŸ” **å‘åå…¼å®¹**: æ”¯æŒæ—§çš„APIï¼Œå¹³æ»‘å‡çº§
- ğŸ•’ **æ—¶åŒºç»Ÿä¸€**: æ‰€æœ‰æ—¶é—´æˆ³é»˜è®¤å†™å…¥ä¸Šæµ·æ—¶åŒºï¼Œæ—¥å¿—ä¸UIæ—¶é—´ä¸€è‡´
- ğŸ›ï¸ **æ‰‹åŠ¨å…³æœºé¢æ¿**: è°ƒåº¦å™¨ç©ºé—²æ—¶ä¿æŒåœ¨çº¿ï¼Œå¾… UI è§¦å‘â€œé€€å‡ºè°ƒåº¦å™¨â€æŒ‰é’®åä¼˜é›…æ”¶å°¾

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…
```bash
pip install -e .
```

å®‰è£…åä¼šæ³¨å†Œåä¸º `EXP` çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºå¯åŠ¨è°ƒåº¦å™¨ UIã€‚åæ–‡æœ‰è¯¦ç»†è¯´æ˜ã€‚

### ä½¿ç”¨ç¤ºä¾‹

#### CNNè®­ç»ƒç¤ºä¾‹

é¡¹ç›®åŒ…å«ä¸€ä¸ªå®Œæ•´çš„CNNè®­ç»ƒç¤ºä¾‹ `cnn_train.py`ï¼Œæ¼”ç¤ºæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼š

```bash
# åŸºç¡€è®­ç»ƒ
python cnn_train.py --epochs 10 --lr 0.001

# è‡ªå®šä¹‰é…ç½®
python cnn_train.py --epochs 20 --lr 0.01 --batch-size 64 --save-model
```

#### æ‰¹é‡è°ƒåº¦å™¨

ä½¿ç”¨ TOML é…ç½®æ‰¹é‡è¿è¡Œå¤šç»„å®éªŒï¼š

```bash
# ä»…æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’
python run_scheduler.py --config example_config.toml --dry-run

# æŒ‰é…ç½®ä¾æ¬¡æ‰§è¡Œå®éªŒï¼ˆæœ€å¤šä½¿ç”¨é…ç½®ä¸­çš„å¹¶å‘æ•°ï¼‰
python run_scheduler.py --config example_config.toml
```

æ¯ä¸ªå®éªŒå¯ä»¥è®¾ç½® `priority`ã€`gpu_ids`ã€`description`ã€`resume` ç­‰å­—æ®µï¼Œè°ƒåº¦å™¨ä¼šè‡ªåŠ¨åœ¨å¯¹åº”ç›®å½•ä¸­æ–°å»º `run_xxxx` è¿è¡Œå¹¶å°†æŒ‡æ ‡å†™å›ã€‚

#### â±ï¸ é•¿æ—¶é—´è°ƒåº¦æ¼”ç¤ºï¼ˆä¾¿äºè§‚å¯Ÿ UI çŠ¶æ€ï¼‰

`toy_example/long_running_config.toml` é¢„è®¾ 3 ä¸ªè€—æ—¶çº¦ 150/210/270 ç§’çš„ä»»åŠ¡ï¼Œé»˜è®¤å¹¶å‘åº¦ä¸º 2ï¼Œå¯åœ¨é¢æ¿ä¸­çœ‹åˆ° Pending â†’ Running â†’ Finished çš„æµè½¬ã€‚

```bash
# ç»ˆç«¯ â‘ ï¼šå¯åŠ¨è°ƒåº¦å™¨ï¼Œè¿è¡Œçº¦ 5 åˆ†é’Ÿï¼ˆå®Œæˆåä¿æŒå¾…å‘½çŠ¶æ€ï¼Œç­‰å¾… UI æŒ‡ä»¤ï¼‰
python toy_example/run_scheduler.py --config toy_example/long_running_config.toml

# ç»ˆç«¯ â‘¡ï¼šå¯åŠ¨ UIï¼Œè§‚å¯Ÿ experiments_long_demo ç›®å½•
EXP experiments_long_demo
```

è§‚å¯Ÿæç¤ºï¼š

- `slow_with_jitter` ä¼šå› ä¸º `--jitter` å‚æ•°å¯¼è‡´è€—æ—¶ç•¥æœ‰æ³¢åŠ¨ã€‚
- æ—¥å¿—é¢æ¿æ¯ 15~30 ç§’è¿½åŠ ä¸€è¡Œè¿›åº¦ï¼Œæ–¹ä¾¿æµ‹è¯•å®æ—¶åˆ·æ–°ã€‚
- æŒ‡æ ‡æŠ½å±‰ä¸­çš„ `progress.csv` ä¼šæŒç»­å¢é•¿ï¼Œå¯ç”¨â€œæŒ‡æ ‡é¢„è§ˆâ€å¿«é€Ÿæ£€æŸ¥å†™å…¥æƒ…å†µã€‚

#### ğŸ›ï¸ è°ƒåº¦å™¨å¯è§†åŒ–é¢æ¿ï¼ˆTensorBoard é£æ ¼ï¼‰

è¿è¡Œè°ƒåº¦å™¨åï¼Œå¯é€šè¿‡è‡ªå¸¦çš„ UI é¢æ¿å®æ—¶æŸ¥çœ‹ Pending/Running/Finished/Error é˜Ÿåˆ—ã€å®éªŒè¯¦æƒ…ã€æ—¥å¿—ä¸æŒ‡æ ‡ï¼š

```bash
EXP experiments
```

- `experiments` æ˜¯è°ƒåº¦å™¨ç”Ÿæˆå®éªŒç›®å½•çš„æ ¹è·¯å¾„ï¼›å¯æ›¿æ¢ä¸ºä½ çš„å®é™…è¾“å‡ºç›®å½•ã€‚
- é»˜è®¤ç›‘å¬ `http://127.0.0.1:6066`ï¼Œè‹¥ç«¯å£å ç”¨ä¼šè‡ªåŠ¨é€‰å–ç©ºé—²ç«¯å£å¹¶æ‰“å°æœ€ç»ˆ URLã€‚
- é»˜è®¤è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼Œå¯é€šè¿‡ `--no-browser` å…³é—­ï¼›ä¹Ÿå¯ä»¥ç”¨ `--host 0.0.0.0 --port 7000` æŒ‡å®šç›‘å¬åœ°å€/ç«¯å£ã€‚

UI é¡µé¢æä¾›ä»¥ä¸‹èƒ½åŠ›ï¼š

- å››ä¸ªçŠ¶æ€é¢æ¿ï¼šä¸€ç›®äº†ç„¶åœ°æŸ¥çœ‹å®éªŒé˜Ÿåˆ—ã€‚
- ç‚¹å‡»å®éªŒå¡ç‰‡æ‰“å¼€è¯¦æƒ…æŠ½å±‰ï¼Œå±•ç¤º `metadata.json`ã€æŒ‡æ ‡é¢„è§ˆä¸æ‰€æœ‰ç»ˆç«¯æ—¥å¿—ã€‚
- ã€Œç›‘æ§ã€æŒ‰é’®æ‰“å¼€å®æ—¶æ—¥å¿—é¢æ¿ï¼ˆå¤šçª—å£æ”¯æŒï¼Œæä¾›åˆ†é¡µåˆ‡æ¢ä¸å¤šåˆ—å¸ƒå±€æŒ‰é’®ï¼‰ã€‚
- åœ¨é”™è¯¯é¢æ¿ä¸­å¯ç›´æ¥ç‚¹å‡»ã€Œé‡è·‘ã€è§¦å‘ `retry_error` å‘½ä»¤ï¼›å…¶ä»–é¢æ¿æä¾›åˆ é™¤/ç»ˆæ­¢æ“ä½œã€‚
- é¡µé¢å³ä¸Šè§’å¯æ‰‹åŠ¨åˆ·æ–°ï¼Œä¹Ÿä¼šæ¯ 3 ç§’è‡ªåŠ¨è½®è¯¢æœ€æ–°çŠ¶æ€ã€‚
- å³ä¸Šè§’çŠ¶æ€èƒ¶å›Šä¼šæ˜¾ç¤ºã€Œè¿è¡Œä¸­ / ç­‰å¾…å…³é—­æŒ‡ä»¤ / å·²åœæ­¢ã€ï¼›å½“è°ƒåº¦å™¨ç©ºé—²åå¯ç‚¹å‡»ã€Œé€€å‡ºè°ƒåº¦å™¨ã€æŒ‰é’®ï¼Œè°ƒåº¦å™¨ä¼šåœ¨åå°å†™å›æœ€ç»ˆçŠ¶æ€åé€€å‡ºã€‚

> ğŸ“Œ **æç¤º**ï¼šè°ƒåº¦å™¨é…ç½® `linger_when_idle` é»˜è®¤ä¸ºå¼€å¯ï¼Œæ‰€æœ‰ä»»åŠ¡å®Œæˆåä¼šä¿æŒç›‘å¬çŠ¶æ€ï¼Œç¡®ä¿ UI/CLI æœ‰æ—¶é—´ä¸‹è½½æ—¥å¿—æˆ–æ‰§è¡Œåç»­å‘½ä»¤ã€‚è‹¥å¸Œæœ›è‡ªåŠ¨é€€å‡ºï¼Œå¯åœ¨ TOML ä¸­å°†è¯¥é…ç½®è®¾ä¸º `false`ã€‚

#### æ ¸å¿ƒAPIç”¨æ³•

```python
from pathlib import Path
from experiment_manager.core.experiment import Experiment

# åˆ›å»ºå®éªŒ - æ™ºèƒ½è¿è¡ŒIDåˆ†é…
exp = Experiment(
    name="my_experiment",
    command="python train.py --epochs 100 --lr 0.001",
    base_dir=Path("./experiments"),
    tags=["deep-learning", "classification"]
)

print(f"æ™ºèƒ½åˆ†é…çš„è¿è¡ŒID: {exp.current_run_id}")  # run_0001

# æ–°çš„CSVæŒ‡æ ‡è®°å½•ç³»ç»Ÿ
exp.upd_row(
    model="ResNet-18",
    dataset="CIFAR-10",
    batch_size=128,
    learning_rate=0.001
)
exp.save_row()  # ä¿å­˜é…ç½®è¡Œ

# è®­ç»ƒå¾ªç¯ä¸­çš„æŒ‡æ ‡è®°å½•
for epoch in range(1, 11):
    # ... è®­ç»ƒä»£ç  ...
    
    # è®°å½•æ¯ä¸ªepochçš„æŒ‡æ ‡
    exp.upd_row(
        epoch=epoch,
        train_loss=train_loss,
        train_acc=train_acc,
        val_loss=val_loss,
        val_acc=val_acc
    )
    exp.save_row()

# pandasæ•°æ®åˆ†æ
df = exp.load_metrics_df()
best_acc = df['val_acc'].max()
best_epoch = df.loc[df['val_acc'].idxmax()]
print(f"æœ€ä½³æ€§èƒ½: Epoch {best_epoch['epoch']}, å‡†ç¡®ç‡ {best_acc:.4f}")
```

## ğŸ“Š CSVæŒ‡æ ‡è®°å½•ç³»ç»Ÿ

### æ ¸å¿ƒä¼˜åŠ¿

ç›¸æ¯”ä¼ ç»Ÿçš„JSONç³»ç»Ÿï¼Œæ–°çš„CSVç³»ç»Ÿæä¾›ï¼š

| ç‰¹æ€§ | æ—§ç³»ç»Ÿ(JSON) | æ–°ç³»ç»Ÿ(CSV) |
|------|-------------|-------------|
| æ•°æ®æ ¼å¼ | JSONå­—å…¸ | CSVè¡¨æ ¼ |
| pandasæ”¯æŒ | éœ€è¦è½¬æ¢ | åŸç”Ÿæ”¯æŒ |
| å­—æ®µç®¡ç† | æ‰‹åŠ¨ | è‡ªåŠ¨ |
| æ•°æ®åˆ†æ | å¤æ‚ | ç®€å• |
| è¿è¡ŒID | æ‰‹åŠ¨è®¾ç½® | æ™ºèƒ½åˆ†é… |
| æ‰©å±•æ€§ | æœ‰é™ | æ— é™ |

### åŠ¨æ€å­—æ®µç¤ºä¾‹

```python
# ç¬¬ä¸€è¡Œï¼šåŸºç¡€å­—æ®µ
exp.upd_row(model="CNN", accuracy=0.85)
exp.save_row()

# ç¬¬äºŒè¡Œï¼šæ·»åŠ æ–°å­—æ®µ - CSVè‡ªåŠ¨æ‰©å±•
exp.upd_row(
    model="CNN", 
    accuracy=0.88,
    f1_score=0.87,     # æ–°å­—æ®µ
    precision=0.89     # æ–°å­—æ®µ
)
exp.save_row()
```

ç”Ÿæˆçš„CSVï¼š
```csv
timestamp,run_id,model,accuracy,f1_score,precision
2025-09-26T14:30:15,run_0001,CNN,0.85,,
2025-09-26T14:30:45,run_0001,CNN,0.88,0.87,0.89
```

## ğŸ› ï¸ APIå‚è€ƒ

### å®éªŒåˆ›å»º
```python
exp = Experiment(
    name="experiment_name",           # å®éªŒåç§°
    command="python train.py",        # æ‰§è¡Œå‘½ä»¤
    base_dir=Path("./experiments"),   # åŸºç¡€ç›®å½•
    tags=["tag1", "tag2"],           # æ ‡ç­¾
    gpu_ids=[0],                      # æŒ‡å®šä½¿ç”¨çš„ GPUï¼ˆå¯é€‰ï¼‰
    description="baseline sweep"      # å®éªŒæè¿°ï¼ˆå¯é€‰ï¼‰
)
```

### CSVæŒ‡æ ‡è®°å½•
```python
# æ›´æ–°å½“å‰è¡Œçš„å­—æ®µ
exp.upd_row(epoch=1, loss=0.5, accuracy=0.85)

# ä¿å­˜å½“å‰è¡Œåˆ°CSV
exp.save_row()

# åŠ è½½æ•°æ®è¿›è¡Œåˆ†æ
df = exp.load_metrics_df()           # pandas DataFrame
metrics = exp.load_metrics_dict()    # å­—å…¸åˆ—è¡¨
```

### å®éªŒç®¡ç†
```python
exp.set_running(pid=12345)           # æ ‡è®°ä¸ºè¿è¡ŒçŠ¶æ€
exp.set_finished()                   # æ ‡è®°ä¸ºå®ŒæˆçŠ¶æ€
exp.append_log("è®­ç»ƒå¼€å§‹")            # æ·»åŠ æ—¥å¿—
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
å®éªŒç›®å½•/
â”œâ”€â”€ experiment_name_2025-09-26__14-30-15/  # å®éªŒå·¥ä½œç›®å½•
â”‚   â”œâ”€â”€ logs/
â”‚   â”‚   â”œâ”€â”€ run_0001.log                    # è¿è¡Œæ—¥å¿—
â”‚   â”‚   â””â”€â”€ experiment.log                  # å®éªŒæ—¥å¿—
â”‚   â”œâ”€â”€ metrics/
â”‚   â”‚   â””â”€â”€ run_0001.csv                    # CSVæŒ‡æ ‡æ–‡ä»¶
â”‚   â”œâ”€â”€ checkpoints/                        # æ¨¡å‹æ£€æŸ¥ç‚¹
â”‚   â”œâ”€â”€ config.json                         # å®éªŒé…ç½®
â”‚   â””â”€â”€ status.json                         # è¿è¡ŒçŠ¶æ€
```

## ğŸš€ é«˜çº§ç‰¹æ€§

### æ™ºèƒ½è¿è¡ŒIDç®¡ç†
- è‡ªåŠ¨æ£€æµ‹å·²æœ‰è¿è¡Œ: `run_0001`, `run_0002`, `run_0003`...
- æ”¯æŒæœ€å¤š9999æ¬¡è¿è¡Œ
- é›¶é…ç½®ï¼Œå®Œå…¨è‡ªåŠ¨åŒ–

### å®Œç¾pandasé›†æˆ
```python
import pandas as pd

# ä¸€é”®åŠ è½½ä¸ºDataFrame
df = exp.load_metrics_df()

# æ•°æ®åˆ†æ
training_curve = df[df['phase'] == 'training']
best_performance = df.loc[df['val_acc'].idxmax()]

# å¯è§†åŒ–
import matplotlib.pyplot as plt
plt.plot(df['epoch'], df['train_acc'], label='Train')
plt.plot(df['epoch'], df['val_acc'], label='Val')
plt.legend()
plt.show()
```

## ğŸ“‹ æ›´æ–°æ—¥å¿—

### v2.0.0 - CSVæŒ‡æ ‡è®°å½•ç³»ç»Ÿ
- âœ… æ–°å¢æ™ºèƒ½è¿è¡ŒIDåˆ†é…ç³»ç»Ÿ
- âœ… æ–°å¢CSVæŒ‡æ ‡è®°å½•ç³»ç»Ÿ
- âœ… æ”¯æŒåŠ¨æ€å­—æ®µæ·»åŠ 
- âœ… å®Œç¾pandasé›†æˆ
- âœ… å‘åå…¼å®¹æ—§API

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä¾æ® [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0) å‘å¸ƒï¼Œæ¬¢è¿è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹ä¸å†å‘è¡Œï¼Œä½†éœ€ä¿ç•™ç‰ˆæƒä¸è®¸å¯å£°æ˜ã€‚